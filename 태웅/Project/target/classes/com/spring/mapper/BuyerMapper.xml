<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace="com.spring.mapper.BoardMapper는 
	 BoardMapper인퍼페이스(BoardMapper.class)의 이름을 사용한다. -->
<!-- root-context에서 아래와 같이 typeAliasesPackage를 설정하면 패키지 경로 생략 가능. -->
<mapper namespace="com.spring.mapper.BuyerMapper">
	
	<!-- id는 Mapper.java(여기선 MemberMapper.java)에 동일하게 사용해야된다. -->  
	<resultMap id="buyerResultMap" type="com.spring.buyer.BuyerVO">
		<result column = "buyer_id" property = "id" />
		<result column = "password" property ="password" />
		<result column = "name" property = "name" />
		<result column = "tel" property = "tel" />
		<result column = "email" property = "email" />
		<result column = "address" property = "address" />
		<result column = "buyer_num" property = "buyerNum" />
		<result column = "grade" property = "grade" />
		<result column = "member_type" property = "memberType" />
		<result column = "del_flag" property = "delFlag" />
		<result column = "join_date" property = "joinDate" />
		<result column = "wthdr_date" property = "wthdrDate" />
		<result column = "save_point" property = "savePoint" />
		<result column = "profile_img" property = "profileImg" />
		<result column = "last_loginDate" property = "loginDate" />
	</resultMap>
	
	  <resultMap type="com.spring.buyer.WishListVO" id="WishListMap">
        <result property="wish_id" column="wish_id" />
        <result property="buyer_id" column="buyer_id" />
        <result property="board_id" column="board_id" />
    </resultMap>
	
	<select id = "selectListAll" resultMap ="buyerResultMap" >
		SELECT * FROM member_buyer 
	</select>
	
	<select id = "selectOneById" resultMap = "buyerResultMap" >
		SELECT * FROM member_buyer WHERE buyer_id = #{id}
	</select>
	
	<select id = "selectCountById" resultType = "int" >
		SELECT count(*) FROM member_buyer WHERE buyer_id = #{id}
	</select>
	
	<insert id = "InsertBuyerAccount" parameterType = "com.spring.buyer.BuyerVO" >
		<selectKey keyProperty="buyerNum" order = "BEFORE" resultType="int">
			SELECT buyer_num_seq.nextval FROM dual
		</selectKey>
		INSERT INTO member_buyer (buyer_id, password, name, tel, email, address, buyer_num)
		VALUES (#{id}, #{password}, #{name}, #{tel}, #{email}, #{address}, #{buyerNum} )
	
	</insert>
	
	<update id = "UpdateBuyerAccount" parameterType = "com.spring.buyer.BuyerVO"  >
		UPDATE member_buyer SET password=#{password}, email=#{email}, tel=#{tel}, profile_img=#{profileImg}
		 WHERE buyer_id = #{id} AND password = #{password}
	</update>
	
	<update id = "UpdateLoginDateBy" parameterType = "com.spring.buyer.BuyerVO" >
		UPDATE member_buyer SET last_loginDate=sysdate WHERE buyer_id = #{id}
	</update>
	
	<delete id = "DeleteBuyerAccount" parameterType ="com.spring.buyer.BuyerVO">
		UPDATE member_buyer SET del_flag="Y", wthdr_date=sysdate 
		WHERE buyer_id = #{id} AND password = #{password}
	</delete>
	
	<!-- id는 Mapper.java(여기선 MemberMapper.java)에 동일하게 사용해야된다. -->  
	<select id="getWishListOverlapCheck" parameterType="String" resultType="int">
	    SELECT COUNT(*) FROM wish_list WHERE board_id = #{board_id} AND buyer_id = #{buyer_id}
	</select>
	
	<insert id="insertWishList" parameterType="com.spring.buyer.WishListVO">
	    INSERT INTO wish_list VALUES (#{wish_id}, #{buyer_id}, #{board_id})
	</insert>
	
	
</mapper>